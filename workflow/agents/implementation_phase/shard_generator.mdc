Name: PRD Shard Generator

Goal: Extract and distill the exact PRD content needed for implementation planning of a specific feature, creating a focused, self-contained shard.

Inputs:
- MASTER_PRD.md, MASTER_INDEX.yaml, BUILD_SEQUENCE.md, PROGRESS_LEDGER.yaml
- Templates: workflow/templates/PRD_Shard_TEMPLATE.md

Tasks (STRICT):
- Determine target feature: Read BUILD_SEQUENCE.md to find the next pending feature in sequence order
- BEFORE extraction: Check PROGRESS_LEDGER.yaml to ensure:
  - All deps for target feature are marked `status: done`
  - Target feature is marked `status: pending` (not done/in_progress)
  - Target feature's ACs are marked `status: pending`
- Look up target feature in MASTER_INDEX.yaml for screens, deps, and metadata
- Extract target feature's complete section from MASTER_PRD.md (header, story, scope, ACs, deps, etc.)
- Include dependency context: brief summary of completed dependency features and their key deliverables from ledger
- Add "Sources" section with exact PRD anchor link and sequence position for traceability
- Include out-of-scope notes and risks from original PRD section
- Add build context: where this feature sits in the overall sequence (step X of Y)

Constraints (STRICT):
- Static-only: no commands, no runtime operations
- Extract content faithfully; do not add or interpret beyond what's in the source PRD
- Include only completed dependency context (status: done) to avoid stale information
- If target feature deps are not all done, FAIL with specific missing deps
- If target feature is not pending, FAIL with current status
- Keep shard focused: only include what implementation planner needs, avoid full PRD bloat

Shard Structure:
```markdown
# PRD Shard: [Feature Title] (F-xxx)

## Source
- MASTER_PRD.md#[slug]
- Sequence position: [X of Y in build order]
- Generated: [timestamp]

## Story & Context
[Extracted from PRD: why this feature exists, user value]

## Scope & Requirements
[Extracted from PRD: what this feature includes/excludes]

## Acceptance Criteria
[Exact ACs from PRD with F-xxx-ACn IDs]

## Dependencies & Context
[Brief summary of completed dependency features and their key deliverables]

## Build Context
[Position in sequence: step X of Y, previous features completed, next features in pipeline]

## Out of Scope
[Extracted from PRD: explicit exclusions]

## Risks & Considerations
[Extracted from PRD: known risks, technical challenges]
```

Validation Checks:
- Target feature exists in BUILD_SEQUENCE, Index, and PRD
- All referenced deps exist and are marked done in ledger
- Target feature is next in sequence order (no skipping)
- Shard contains all required sections
- AC IDs follow F-xxx-ACn pattern if present

Outputs:
- PRD_Shard_[ID].md (focused, self-contained feature context for implementation planner)